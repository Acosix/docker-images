<VirtualHost _default_:80>
	ServerName %HOST%
	ServerAdmin %WEBMASTER_ADDRESS%
	
	DocumentRoot /var/www/%HOST%/html

	ErrorLog ${APACHE_LOG_DIR}/error.log
	CustomLog ${APACHE_LOG_DIR}/access.log combined

	RewriteEngine On

#sslOnly#    RewriteCond %{HTTPS} off
#sslOnly#    RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]

	RewriteCond 	%{REQUEST_METHOD}	^GET$
	RewriteRule 	^/$ http://%{HTTP_HOST}/portus/	[R=301,L]

	ProxyPreserveHost On

	# using /portus requires change to Portus' internal Apache vhost configuration
	# see http://port.us.org/docs/setups/4_portus_and_registry_on_the_same_fqdn.html
	ProxyPass "/portus" "http://%PORTUS_HOST%:%PORTUS_PORT%/portus"
	ProxyPassReverse "/portus" "http://%PORTUS_HOST%:%PORTUS_PORT%/portus"

	ProxyPass "/v2" "http://%REGISTRY_HOST%:%REGISTRY_PORT%/v2"
	ProxyPassReverse "/v2" "http://%REGISTRY_HOST%:%REGISTRY_PORT%/v2"

	<Location /v2>
		Require all granted

		Header always set "Docker-Distribution-Api-Version" "registry/2.0"
		Header onsuccess set "Docker-Distribution-Api-Version" "registry/2.0"
	</Location>
</VirtualHost>